#load "entity.zen";
// #load "draw.zen";

namespace game;

struct Player
{
	Entity entity;
	raylib::Color color = raylib::Yellow;
}

const float PLAYER_SPEED = 500.0;

fun void player_init(Player* player)
{
	// @TEMP, should use an enum but those are broken lol
	player.entity.player = true;
	// player.entity.type = EntityType::Player;
}

fun void player_update(Player* player)
{
	entity_update(&player.entity);

	var int dx = 0;
	var int dy = 0;

	if (raylib::IsKeyPressed(raylib::KeyboardKey::LEFT))
	{
		dx -= 1;
	}
	if (raylib::IsKeyPressed(raylib::KeyboardKey::RIGHT))
	{
		dx += 1;
	}
	if (raylib::IsKeyPressed(raylib::KeyboardKey::UP))
	{
		dy -= 1;
	}
	if (raylib::IsKeyPressed(raylib::KeyboardKey::DOWN))
	{
		dy += 1;
	}

	if (dx == 0 && dy == 0)
	{
		// we didn't move lol
		return;
	}

	map_move_entity(&player.entity, dx, dy);
}

fun void player_draw(Player* player)
{
	let float x = player.entity.visualX * cast(float)CELL_WIDTH;
	let float y = player.entity.visualY * cast(float)CELL_HEIGHT;

	// draw_rect(x, y, cast(float)CELL_WIDTH, cast(float)CELL_HEIGHT, player.color);
	
	let raylib::Rectangle src = { 0.0, 0.0, cast(float)sprite_player.width, cast(float)sprite_player.height };
	let raylib::Rectangle dest = { x, y, cast(float)CELL_WIDTH, cast(float)CELL_HEIGHT };
	let raylib::Vector2 origin = { 0.0, 0.0 };
	raylib::DrawTexturePro(sprite_player, src, dest, origin, 0.0, raylib::White);
}
#load "entity.zen";
#load "player.zen";
#load "crate.zen";

#load "../tests/raylib.zen";
#load "../std/math.zen";
#load "../std/memory.zen";

fun void main()
{
	game::start_game();
}

namespace game;

const int32 GAME_WIDTH  = 320;
const int32 GAME_HEIGHT = 180;

const int32 CELL_WIDTH = 32;
const int32 CELL_HEIGHT = 32;

let float delta_time = 0.0;
let float game_time = 0.0;
let uint64 game_frame = 0;

struct GameManager
{
	Player* player;
}

fun void start_game()
{
    let raylib::Color black;
	black.r = 0; black.g = 0; black.b = 0; black.a = 255;

    raylib::InitWindow(GAME_WIDTH * 4, GAME_HEIGHT * 4, "Zen");
	raylib::SetTargetFPS(185);

	let GameManager gameManager;
	let Player player;

	gameManager.player = &player;
	player_init(gameManager.player);

	let int width = 32;
	let int height = 32;

	let bool[128] tiles;

	while (!raylib::WindowShouldClose())
	{
		game_update(&gameManager);

		raylib::BeginDrawing();
		raylib::ClearBackground(black);
		
		game_draw(&gameManager);

		raylib::DrawFPS(20, 20);

		raylib::EndDrawing();
	}
	raylib::CloseWindow();
}

fun void game_update(GameManager* gameManager)
{
	delta_time = raylib::GetFrameTime();
	game_time += delta_time;
	game_frame += 1;

	player_update(gameManager.player);
}

fun void game_draw(GameManager* gameManager)
{
	player_draw(gameManager.player);

	let float sinx = math::sinf(game_time * 8.0) * 44.0;
	let float siny = math::cosf(game_time * 8.0) * 44.0;
	raylib::DrawCircle(cast(int)sinx + 400, cast(int)siny + 400, 32, gameManager.player.color);

	println(sinx);
}
#load "entity.zen";
#load "player.zen";
#load "crate.zen";
#load "map.zen";
#load "assets.zen";

#load "../extern/raylib.zen";
#load "../std/math.zen";
#load "../std/memory.zen";

fun void main()
{
	game::start_game();
}

namespace game;

const int32 GAME_WIDTH  = 320;
const int32 GAME_HEIGHT = 180;

const int32 GAME_ZOOM = 4;

const int32 CELL_WIDTH = 16;
const int32 CELL_HEIGHT = 16;

let float delta_time = 0.0;
let float game_time = 0.0;
let uint64 game_frame = 0;

struct GameManager
{
	float t;
}

fun void start_game()
{
    raylib::InitWindow(GAME_WIDTH * GAME_ZOOM, GAME_HEIGHT * GAME_ZOOM, "Zen");
	// raylib::SetTargetFPS(185);

	assets_load();

	let GameManager gameManager;

	map_load();

	let raylib::Camera2D cam;
	cam.target.x = -cast(float)(58);
	cam.target.y = -cast(float)(32);
	cam.zoom = cast(float)GAME_ZOOM;

	while (!raylib::WindowShouldClose())
	{
		game_update(&gameManager);

		raylib::BeginDrawing();
		raylib::ClearBackground(raylib::DarkGray);

		raylib::BeginMode2D(cam);
		game_draw(&gameManager);
		raylib::EndMode2D();

		raylib::DrawFPS(20, 20);

		raylib::EndDrawing();
	}

	assets_unload();

	raylib::CloseWindow();
}

fun void game_update(GameManager* gameManager)
{
	delta_time = raylib::GetFrameTime();
	game_time += delta_time;
	game_frame += 1;

	map_update();
}

fun void game_draw(GameManager* gameManager)
{
	map_draw();
}